!function(t){"use strict";var e=function(n,i){var r=navigator.userAgent.toLowerCase();this.opt=t.extend({},e.defaults,i||{}),this.container=t(n),this.opt.is_msie=/msie/.test(r),this.opt.is_ie_lt9=/msie [1-8]\./.test(r),this.container.addClass(this.opt.css_container),this.ui={},this.state=null,this.ui.multi=[],this.ui.selection=null,this.filter={},this.init(),this.setOptions(i),this.applySizeConstraints(),this.container.trigger("cropinit",this),this.opt.is_ie_lt9&&(this.opt.dragEventTarget=document.body)};t.extend(e,{component:{},filter:{},stage:{},registerComponent:function(t,n){e.component[t]=n},registerFilter:function(t,n){e.filter[t]=n},registerStageType:function(t,n){e.stage[t]=n},attach:function(e,n){var i=new t.Jcrop(e,n);return i},imgCopy:function(t){var e=new Image;return e.src=t.src,e},imageClone:function(n){return t.Jcrop.supportsCanvas?e.canvasClone(n):e.imgCopy(n)},canvasClone:function(e){var n=document.createElement("canvas"),i=n.getContext("2d");return t(n).width(e.width).height(e.height),n.width=e.naturalWidth,n.height=e.naturalHeight,i.drawImage(e,0,0,e.naturalWidth,e.naturalHeight),n},propagate:function(t,e,n){for(var i=0,r=t.length;r>i;i++)e.hasOwnProperty(t[i])&&(n[t[i]]=e[t[i]])},getLargestBox:function(t,e,n){return e/n>t?[n*t,n]:[e,e/t]},stageConstructor:function(n,i,r){var o=[];t.each(e.stage,function(t,e){o.push(e)}),o.sort(function(t,e){return t.priority-e.priority});for(var s=0,a=o.length;a>s;s++)if(o[s].isSupported(n,i)){o[s].create(n,i,function(t,e){"function"==typeof r&&r(t,e)});break}},supportsColorFade:function(){return t.fx.step.hasOwnProperty("backgroundColor")},wrapFromXywh:function(t){var e={x:t[0],y:t[1],w:t[2],h:t[3]};return e.x2=e.x+e.w,e.y2=e.y+e.h,e}});var i=function(){};t.extend(i,{isSupported:function(t,e){return!0},priority:100,create:function(t,e,n){var r=new i;r.element=t,n.call(this,r,e)},prototype:{attach:function(t){this.init(t),t.ui.stage=this},triggerEvent:function(e){return t(this.element).trigger(e),this},getElement:function(){return this.element}}}),e.registerStageType("Block",i);var r=function(){};r.prototype=new i,t.extend(r,{isSupported:function(t,e){return"IMG"==t.tagName?!0:void 0},priority:90,create:function(e,n,i){t.Jcrop.component.ImageLoader.attach(e,function(o,s){var a=new r;a.element=t(e).wrap("<div />").parent(),a.element.width(o).height(s),a.imgsrc=e,"function"==typeof i&&i.call(this,a,n)})}}),e.registerStageType("Image",r);var o=function(){this.angle=0,this.scale=1,this.scaleMin=.2,this.scaleMax=1.25,this.offset=[0,0]};o.prototype=new r,t.extend(o,{isSupported:function(e,n){return t.Jcrop.supportsCanvas&&"IMG"==e.tagName?!0:void 0},priority:60,create:function(e,n,i){var r=t(e),s=t.extend({},n);t.Jcrop.component.ImageLoader.attach(e,function(t,n){var a=new o;r.hide(),a.createCanvas(e,t,n),r.before(a.element),a.imgsrc=e,s.imgsrc=e,"function"==typeof i&&(i(a,s),a.redraw())})}}),t.extend(o.prototype,{init:function(t){this.core=t},setOffset:function(t,e){return this.offset=[t,e],this},setAngle:function(t){return this.angle=t,this},setScale:function(t){return this.scale=this.boundScale(t),this},boundScale:function(t){return t<this.scaleMin?t=this.scaleMin:t>this.scaleMax&&(t=this.scaleMax),t},createCanvas:function(e,n,i){this.width=n,this.height=i,this.canvas=document.createElement("canvas"),this.canvas.width=n,this.canvas.height=i,this.$canvas=t(this.canvas).width("100%").height("100%"),this.context=this.canvas.getContext("2d"),this.fillstyle="rgb(0,0,0)",this.element=this.$canvas.wrap("<div />").parent().width(n).height(i)},triggerEvent:function(t){return this.$canvas.trigger(t),this},clear:function(){return this.context.fillStyle=this.fillstyle,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this},redraw:function(){return this.context.save(),this.clear(),this.context.translate(parseInt(.5*this.width),parseInt(.5*this.height)),this.context.translate(this.offset[0]/this.core.opt.xscale,this.offset[1]/this.core.opt.yscale),this.context.rotate(this.angle*(Math.PI/180)),this.context.scale(this.scale,this.scale),this.context.translate(-parseInt(.5*this.width),-parseInt(.5*this.height)),this.context.drawImage(this.imgsrc,0,0,this.width,this.height),this.context.restore(),this.$canvas.trigger("cropredraw"),this},setFillStyle:function(t){return this.fillstyle=t,this}}),e.registerStageType("Canvas",o);var s=function(){this.minw=40,this.minh=40,this.maxw=0,this.maxh=0,this.core=null};t.extend(s.prototype,{tag:"backoff",priority:22,filter:function(t){var e=this.bound;return t.x<e.minx&&(t.x=e.minx,t.x2=t.w+t.x),t.y<e.miny&&(t.y=e.miny,t.y2=t.h+t.y),t.x2>e.maxx&&(t.x2=e.maxx,t.x=t.x2-t.w),t.y2>e.maxy&&(t.y2=e.maxy,t.y=t.y2-t.h),t},refresh:function(t){this.elw=t.core.container.width(),this.elh=t.core.container.height(),this.bound={minx:0+t.edge.w,miny:0+t.edge.n,maxx:this.elw+t.edge.e,maxy:this.elh+t.edge.s}}}),e.registerFilter("backoff",s);var a=function(){this.core=null};t.extend(a.prototype,{tag:"constrain",priority:5,filter:function(t,e){return"move"==e?(t.x<this.minx&&(t.x=this.minx,t.x2=t.w+t.x),t.y<this.miny&&(t.y=this.miny,t.y2=t.h+t.y),t.x2>this.maxx&&(t.x2=this.maxx,t.x=t.x2-t.w),t.y2>this.maxy&&(t.y2=this.maxy,t.y=t.y2-t.h)):(t.x<this.minx&&(t.x=this.minx),t.y<this.miny&&(t.y=this.miny),t.x2>this.maxx&&(t.x2=this.maxx),t.y2>this.maxy&&(t.y2=this.maxy)),t.w=t.x2-t.x,t.h=t.y2-t.y,t},refresh:function(t){this.elw=t.core.container.width(),this.elh=t.core.container.height(),this.minx=0+t.edge.w,this.miny=0+t.edge.n,this.maxx=this.elw+t.edge.e,this.maxy=this.elh+t.edge.s}}),e.registerFilter("constrain",a);var c=function(){this.core=null};t.extend(c.prototype,{tag:"extent",priority:12,offsetFromCorner:function(t,e,n){var i=e[0],r=e[1];switch(t){case"bl":return[n.x2-i,n.y,i,r];case"tl":return[n.x2-i,n.y2-r,i,r];case"br":return[n.x,n.y,i,r];case"tr":return[n.x,n.y2-r,i,r]}},getQuadrant:function(t){var e=t.opposite[0]-t.offsetx,n=t.opposite[1]-t.offsety;return 0>e&&0>n?"br":e>=0&&n>=0?"tl":0>e&&n>=0?"tr":"bl"},filter:function(t,n,i){if("move"==n)return t;var r=t.w,o=t.h,s=i.state,a=this.limits,c=s?this.getQuadrant(s):"br";return a.minw&&r<a.minw&&(r=a.minw),a.minh&&o<a.minh&&(o=a.minh),a.maxw&&r>a.maxw&&(r=a.maxw),a.maxh&&o>a.maxh&&(o=a.maxh),r==t.w&&o==t.h?t:e.wrapFromXywh(this.offsetFromCorner(c,[r,o],t))},refresh:function(t){this.elw=t.core.container.width(),this.elh=t.core.container.height(),this.limits={minw:t.minSize[0],minh:t.minSize[1],maxw:t.maxSize[0],maxh:t.maxSize[1]}}}),e.registerFilter("extent",c);var h=function(){this.stepx=1,this.stepy=1,this.core=null};t.extend(h.prototype,{tag:"grid",priority:19,filter:function(t){var e={x:Math.round(t.x/this.stepx)*this.stepx,y:Math.round(t.y/this.stepy)*this.stepy,x2:Math.round(t.x2/this.stepx)*this.stepx,y2:Math.round(t.y2/this.stepy)*this.stepy};return e.w=e.x2-e.x,e.h=e.y2-e.y,e}}),e.registerFilter("grid",h);var u=function(){this.ratio=0,this.core=null};t.extend(u.prototype,{tag:"ratio",priority:15,offsetFromCorner:function(t,e,n){var i=e[0],r=e[1];switch(t){case"bl":return[n.x2-i,n.y,i,r];case"tl":return[n.x2-i,n.y2-r,i,r];case"br":return[n.x,n.y,i,r];case"tr":return[n.x,n.y2-r,i,r]}},getBoundRatio:function(t,n){var i=e.getLargestBox(this.ratio,t.w,t.h);return e.wrapFromXywh(this.offsetFromCorner(n,i,t))},getQuadrant:function(t){var e=t.opposite[0]-t.offsetx,n=t.opposite[1]-t.offsety;return 0>e&&0>n?"br":e>=0&&n>=0?"tl":0>e&&n>=0?"tr":"bl"},filter:function(t,e,n){if(!this.ratio)return t;var i=(t.w/t.h,n.state),r=i?this.getQuadrant(i):"br";if(e=e||"se","move"==e)return t;switch(e){case"n":t.x2=this.elw,t.w=t.x2-t.x,r="tr";break;case"s":t.x2=this.elw,t.w=t.x2-t.x,r="br";break;case"e":t.y2=this.elh,t.h=t.y2-t.y,r="br";break;case"w":t.y2=this.elh,t.h=t.y2-t.y,r="bl"}return this.getBoundRatio(t,r)},refresh:function(t){this.ratio=t.aspectRatio,this.elw=t.core.container.width(),this.elh=t.core.container.height()}}),e.registerFilter("ratio",u);var l=function(){this.core=null};t.extend(l.prototype,{tag:"round",priority:90,filter:function(t){var e={x:Math.round(t.x),y:Math.round(t.y),x2:Math.round(t.x2),y2:Math.round(t.y2)};return e.w=e.x2-e.x,e.h=e.y2-e.y,e}}),e.registerFilter("round",l);var p=function(t,e){this.color=e||"black",this.opacity=t||.5,this.core=null,this.shades={}};t.extend(p.prototype,{tag:"shader",fade:!0,fadeEasing:"swing",fadeSpeed:320,priority:95,init:function(){var e=this;e.attached||(e.visible=!1,e.container=t("<div />").addClass(e.core.opt.css_shades).prependTo(this.core.container).hide(),e.elh=this.core.container.height(),e.elw=this.core.container.width(),e.shades={top:e.createShade(),right:e.createShade(),left:e.createShade(),bottom:e.createShade()},e.attached=!0)},destroy:function(){this.container.remove()},setColor:function(n,i){var r=this;if(n==r.color)return r;this.color=n;var o=e.supportsColorFade();return t.each(r.shades,function(t,e){r.fade&&!i&&o?e.animate({backgroundColor:n},{queue:!1,duration:r.fadeSpeed,easing:r.fadeEasing}):e.css("backgroundColor",n)}),r},setOpacity:function(e,n){var i=this;return e==i.opacity?i:(i.opacity=e,t.each(i.shades,function(t,r){!i.fade||n?r.css({opacity:e}):r.animate({opacity:e},{queue:!1,duration:i.fadeSpeed,easing:i.fadeEasing})}),i)},createShade:function(){return t("<div />").css({position:"absolute",backgroundColor:this.color,opacity:this.opacity}).appendTo(this.container)},refresh:function(t){var e=this.core,n=this.shades;this.setColor(t.bgColor?t.bgColor:this.core.opt.bgColor),this.setOpacity(t.bgOpacity?t.bgOpacity:this.core.opt.bgOpacity),this.elh=e.container.height(),this.elw=e.container.width(),n.right.css("height",this.elh+"px"),n.left.css("height",this.elh+"px")},filter:function(t,e,n){if(!n.active)return t;var i=this,r=i.shades;return r.top.css({left:Math.round(t.x)+"px",width:Math.round(t.w)+"px",height:Math.round(t.y)+"px"}),r.bottom.css({top:Math.round(t.y2)+"px",left:Math.round(t.x)+"px",width:Math.round(t.w)+"px",height:i.elh-Math.round(t.y2)+"px"}),r.right.css({left:Math.round(t.x2)+"px",width:i.elw-Math.round(t.x2)+"px"}),r.left.css({width:Math.round(t.x)+"px"}),i.visible||(i.container.show(),i.visible=!0),t}}),e.registerFilter("shader",p);var f=function(t){this.stage=t,this.core=t.core,this.cloneStagePosition()};f.prototype={cloneStagePosition:function(){var t=this.stage;this.angle=t.angle,this.scale=t.scale,this.offset=t.offset},getElement:function(){var e=this.stage;return t("<div />").css({position:"absolute",top:e.offset[0]+"px",left:e.offset[1]+"px",width:e.angle+"px",height:e.scale+"px"})},animate:function(t){var e=this;this.scale=this.stage.boundScale(this.scale),e.stage.triggerEvent("croprotstart"),e.getElement().animate({top:e.offset[0]+"px",left:e.offset[1]+"px",width:e.angle+"px",height:e.scale+"px"},{easing:e.core.opt.animEasing,duration:e.core.opt.animDuration,complete:function(){e.stage.triggerEvent("croprotend"),"function"==typeof t&&t.call(this)},progress:function(t){var n,i={},r=t.tweens;for(n=0;n<r.length;n++)i[r[n].prop]=r[n].now;e.stage.setAngle(i.width).setScale(i.height).setOffset(i.top,i.left).redraw()}})}},e.stage.Canvas.prototype.getAnimator=function(){return new f(this)},e.registerComponent("CanvasAnimator",f);var d=function(t){this.selection=t,this.core=t.core};d.prototype={getElement:function(){var e=this.selection.get();return t("<div />").css({position:"absolute",top:e.y+"px",left:e.x+"px",width:e.w+"px",height:e.h+"px"})},animate:function(t,e,n,i,r){var o=this;o.selection.allowResize(!1),o.getElement().animate({top:e+"px",left:t+"px",width:n+"px",height:i+"px"},{easing:o.core.opt.animEasing,duration:o.core.opt.animDuration,complete:function(){o.selection.allowResize(!0),r&&r.call(this)},progress:function(t){var e,n={},i=t.tweens;for(e=0;e<i.length;e++)n[i[e].prop]=i[e].now;var r={x:parseInt(n.left),y:parseInt(n.top),w:parseInt(n.width),h:parseInt(n.height)};r.x2=r.x+r.w,r.y2=r.y+r.h,o.selection.updateRaw(r,"se")}})}},e.registerComponent("Animator",d);var g=function(t,e,n){var i=this;i.x=t.pageX,i.y=t.pageY,i.selection=e,i.eventTarget=e.core.opt.dragEventTarget,i.orig=e.get(),e.callFilterFunction("refresh");var r=e.core.container.position();i.elx=r.left,i.ely=r.top,i.offsetx=0,i.offsety=0,i.ord=n,i.opposite=i.getOppositeCornerOffset(),i.initEvents(t)};g.prototype={getOppositeCornerOffset:function(){var t=this.orig,e=this.x-this.elx-t.x,n=this.y-this.ely-t.y;switch(this.ord){case"nw":case"w":return[t.w-e,t.h-n];case"sw":return[t.w-e,-n];case"se":case"s":case"e":return[-e,-n];case"ne":case"n":return[-e,t.h-n]}return[null,null]},initEvents:function(e){t(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())},dragEvent:function(t){this.offsetx=t.pageX-this.x,this.offsety=t.pageY-this.y,this.selection.updateRaw(this.getBox(),this.ord)},endDragEvent:function(t){var e=this.selection;e.core.container.removeClass("jcrop-dragging"),e.element.trigger("cropend",[e,e.core.unscale(e.get())]),e.focus()},createStopHandler:function(){var e=this;return function(n){return t(e.eventTarget).off(".jcrop"),e.endDragEvent(n),!1}},createDragHandler:function(){var t=this;return function(e){return t.dragEvent(e),!1}},update:function(t,e){var n=this;n.offsetx=t-n.x,n.offsety=e-n.y},resultWrap:function(t){var e={x:Math.min(t[0],t[2]),y:Math.min(t[1],t[3]),x2:Math.max(t[0],t[2]),y2:Math.max(t[1],t[3])};return e.w=e.x2-e.x,e.h=e.y2-e.y,e},getBox:function(){var t=this,e=t.orig,n={x2:e.x+e.w,y2:e.y+e.h};switch(t.ord){case"n":return t.resultWrap([e.x,t.offsety+e.y,n.x2,n.y2]);case"s":return t.resultWrap([e.x,e.y,n.x2,t.offsety+n.y2]);case"e":return t.resultWrap([e.x,e.y,t.offsetx+n.x2,n.y2]);case"w":return t.resultWrap([e.x+t.offsetx,e.y,n.x2,n.y2]);case"sw":return t.resultWrap([t.offsetx+e.x,e.y,n.x2,t.offsety+n.y2]);case"se":return t.resultWrap([e.x,e.y,t.offsetx+n.x2,t.offsety+n.y2]);case"ne":return t.resultWrap([e.x,t.offsety+e.y,t.offsetx+n.x2,n.y2]);case"nw":return t.resultWrap([t.offsetx+e.x,t.offsety+e.y,n.x2,n.y2]);case"move":return n.nx=e.x+t.offsetx,n.ny=e.y+t.offsety,t.resultWrap([n.nx,n.ny,n.nx+e.w,n.ny+e.h])}}},e.registerComponent("DragState",g);var m=function(t){this.core=t};m.prototype={on:function(e,n){t(this).on(e,n)},off:function(e){t(this).off(e)},trigger:function(e){t(this).trigger(e)}},e.registerComponent("EventManager",m);var v=function(t,e,n){this.src=t,e||(e=new Image),this.element=e,this.callback=n,this.load()};t.extend(v,{attach:function(t,e){return new v(t.src,t,e)},prototype:{getDimensions:function(){var t=this.element;return t.naturalWidth?[t.naturalWidth,t.naturalHeight]:t.width?[t.width,t.height]:null},fireCallback:function(){this.element.onload=null,"function"==typeof this.callback&&this.callback.apply(this,this.getDimensions())},isLoaded:function(){return this.element.complete},load:function(){var t=this,e=t.element;e.src=t.src,t.isLoaded()?t.fireCallback():t.element.onload=function(e){t.fireCallback()}}}}),e.registerComponent("ImageLoader",v);var y=function(t){this.core=t,this.init()};t.extend(y,{support:function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?!0:void 0},prototype:{init:function(){var e=this,n=t.Jcrop.component.DragState.prototype;n.touch||(e.initEvents(),e.shimDragState(),e.shimStageDrag(),n.touch=!0)},shimDragState:function(){var e=this;t.Jcrop.component.DragState.prototype.initEvents=function(n){"touch"==n.type.substr(0,5)?t(this.eventTarget).on("touchmove.jcrop.jcrop-touch",e.dragWrap(this.createDragHandler())).on("touchend.jcrop.jcrop-touch",this.createStopHandler()):t(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())}},shimStageDrag:function(){this.core.container.addClass("jcrop-touch").on("touchstart.jcrop.jcrop-stage",this.dragWrap(this.core.ui.manager.startDragHandler()))},dragWrap:function(t){return function(e){return e.preventDefault(),e.stopPropagation(),"touch"==e.type.substr(0,5)?(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,t(e)):!1}},initEvents:function(){var t=this,e=t.core;e.container.on("touchstart.jcrop.jcrop-touch","."+e.opt.css_drag,t.dragWrap(e.startDrag()))}}}),e.registerComponent("Touch",y);var x=function(t){this.core=t,this.init()};t.extend(x,{defaults:{eventName:"keydown.jcrop",passthru:[9],debug:!1},prototype:{init:function(){t.extend(this,x.defaults),this.enable()},disable:function(){this.core.container.off(this.eventName)},enable:function(){var e=this,n=e.core;n.container.on(e.eventName,function(i){var r=i.shiftKey?16:2;if(t.inArray(i.keyCode,e.passthru)>=0)return!0;switch(i.keyCode){case 37:n.nudge(-r,0);break;case 38:n.nudge(0,-r);break;case 39:n.nudge(r,0);break;case 40:n.nudge(0,r);break;case 46:case 8:return n.requestDelete(),!1;default:e.debug&&console.log("keycode: "+i.keyCode)}i.metaKey||i.ctrlKey||i.preventDefault()})}}}),e.registerComponent("Keyboard",x);var w=function(){};t.extend(w,{defaults:{minSize:[8,8],maxSize:[0,0],aspectRatio:0,edge:{n:0,s:0,e:0,w:0},bgColor:null,bgOpacity:null,last:null,state:null,active:!0,linked:!0,canDelete:!0,canDrag:!0,canResize:!0,canSelect:!0},prototype:{init:function(t){this.core=t,this.startup(),this.linked=this.core.opt.linked,this.attach(),this.setOptions(this.core.opt),t.container.trigger("cropcreate",[this])},attach:function(){},startup:function(){var e=this,n=e.core.opt;t.extend(e,w.defaults),e.filter=e.core.getDefaultFilters(),e.element=t("<div />").addClass(n.css_selection).data({selection:e}),e.frame=t("<button />").addClass(n.css_button).data("ord","move").attr("type","button"),e.element.append(e.frame).appendTo(e.core.container),e.core.opt.is_msie&&e.frame.css({opacity:0,backgroundColor:"white"}),e.insertElements(),e.frame.on("focus.jcrop",function(t){e.core.setSelection(e),e.element.trigger("cropfocus",e),e.element.addClass("jcrop-focus")}).on("blur.jcrop",function(t){e.element.removeClass("jcrop-focus"),e.element.trigger("cropblur",e)})},propagate:["canDelete","canDrag","canResize","canSelect","minSize","maxSize","aspectRatio","edge"],setOptions:function(t){return e.propagate(this.propagate,t,this),this.refresh(),this},refresh:function(){this.allowResize(),this.allowDrag(),this.allowSelect(),this.callFilterFunction("refresh"),this.updateRaw(this.get(),"se")},callFilterFunction:function(t,e){for(var n=0;n<this.filter.length;n++)this.filter[n][t]&&this.filter[n][t](this);return this},addFilter:function(t){t.core=this.core,this.hasFilter(t)||(this.filter.push(t),this.sortFilters(),t.init&&t.init(),this.refresh())},hasFilter:function(t){var e,n=this.filter;for(e=0;e<n.length;e++)if(n[e]===t)return!0},sortFilters:function(){this.filter.sort(function(t,e){return t.priority-e.priority})},clearFilters:function(){for(var t,e=this.filter,t=0;t<e.length;t++)e[t].destroy&&e[t].destroy();this.filter=[]},removeFilter:function(t){for(var e,n=this.filter,i=[],e=0;e<n.length;e++)n[e].tag&&n[e].tag==t||t===n[e]?n[e].destroy&&n[e].destroy():i.push(n[e]);this.filter=i},runFilters:function(t,e){for(var n=0;n<this.filter.length;n++)t=this.filter[n].filter(t,e,this);return t},endDrag:function(){this.state&&(t(document.body).off(".jcrop"),this.focus(),this.state=null)},startDrag:function(n,i){var r=this;r.core;return i=i||t(n.target).data("ord"),this.focus(),"move"==i&&r.element.hasClass(r.core.opt.css_nodrag)?!1:(this.state=new e.component.DragState(n,this,i),!1)},allowSelect:function(t){return void 0===t&&(t=this.canSelect),t&&this.canSelect?this.frame.attr("disabled",!1):this.frame.attr("disabled","disabled"),this},allowDrag:function(t){var e=this,n=e.core.opt;return void 0==t&&(t=e.canDrag),t&&e.canDrag?e.element.removeClass(n.css_nodrag):e.element.addClass(n.css_nodrag),this},allowResize:function(t){var e=this,n=e.core.opt;return void 0==t&&(t=e.canResize),t&&e.canResize?e.element.removeClass(n.css_noresize):e.element.addClass(n.css_noresize),this},remove:function(){this.element.trigger("cropremove",this),this.element.remove()},toBack:function(){this.active=!1,this.element.removeClass("jcrop-current jcrop-focus")},toFront:function(){this.active=!0,this.element.addClass("jcrop-current"),this.callFilterFunction("refresh"),this.refresh()},redraw:function(t){return this.moveTo(t.x,t.y),this.resize(t.w,t.h),this.last=t,this},update:function(t,e){return this.updateRaw(this.core.scale(t),e)},updateRaw:function(t,e){return t=this.runFilters(t,e),this.redraw(t),this.element.trigger("cropmove",[this,this.core.unscale(t)]),this},animateTo:function(t,n){var i=new e.component.Animator(this),r=this.core.scale(e.wrapFromXywh(t));i.animate(r.x,r.y,r.w,r.h,n)},center:function(t){var e=this.get(),n=this.core,i=n.container.width(),r=n.container.height(),o=[(i-e.w)/2,(r-e.h)/2,e.w,e.h];return this[t?"setSelect":"animateTo"](o)},createElement:function(e,n){return t("<div />").addClass(e+" ord-"+n).data("ord",n)},moveTo:function(t,e){this.element.css({top:e+"px",left:t+"px"})},blur:function(){return this.element.blur(),this},focus:function(){return this.core.setSelection(this),this.frame.focus(),this},resize:function(t,e){this.element.css({width:t+"px",height:e+"px"})},get:function(){var t=this.element,e=t.position(),n=t.width(),i=t.height(),r={x:e.left,y:e.top};return r.x2=r.x+n,r.y2=r.y+i,r.w=n,r.h=i,r},insertElements:function(){var t,e=this,n=(e.core,e.element),i=e.core.opt,r=i.borders,o=i.handles,s=i.dragbars;for(t=0;t<s.length;t++)n.append(e.createElement(i.css_dragbars,s[t]));for(t=0;t<o.length;t++)n.append(e.createElement(i.css_handles,o[t]));for(t=0;t<r.length;t++)n.append(e.createElement(i.css_borders,r[t]))}}}),e.registerComponent("Selection",w);var b=function(e,n){t.extend(this,b.defaults,n||{}),this.manager=e,this.core=e.core};b.defaults={offset:[-8,-8],active:!0,minsize:[20,20]},t.extend(b.prototype,{start:function(n){var i=this.core;if(i.opt.allowSelect){if(i.opt.multi&&i.opt.multiMax&&i.ui.multi.length>=i.opt.multiMax)return!1;var r=t(n.currentTarget).offset(),o=n.pageX-r.left+this.offset[0],s=n.pageY-r.top+this.offset[1],a=i.ui.multi;if(!i.opt.multi)if(i.opt.multiCleanup){for(var c=0;c<a.length;c++)a[c].remove();i.ui.multi=[]}else i.removeSelection(i.ui.selection);i.container.addClass("jcrop-dragging");var h=i.newSelection().updateRaw(e.wrapFromXywh([o,s,1,1]));return h.element.trigger("cropstart",[h,this.core.unscale(h.get())]),h.startDrag(n,"se")}},end:function(t,e){this.drag(t,e);var n=this.sel.get();this.core.container.removeClass("jcrop-dragging"),n.w<this.minsize[0]||n.h<this.minsize[1]?this.core.requestDelete():this.sel.focus()}}),e.registerComponent("StageDrag",b);var C=function(t){this.core=t,this.ui=t.ui,this.init()};t.extend(C.prototype,{init:function(){this.setupEvents(),this.dragger=new b(this)},tellConfigUpdate:function(t){for(var e=0,n=this.ui.multi,i=n.length;i>e;e++)n[e].setOptions&&(n[e].linked||this.core.opt.linkCurrent&&n[e]==this.ui.selection)&&n[e].setOptions(t)},startDragHandler:function(){var t=this;return function(e){return!e.button||t.core.opt.is_ie_lt9?t.dragger.start(e):void 0}},removeEvents:function(){this.core.event.off(".jcrop-stage"),this.core.container.off(".jcrop-stage")},shimLegacyHandlers:function(e){var n,i=this.core;t.each(i.opt.legacyHandlers,function(t,r){t in e&&(n=e[t],i.container.off(".jcrop-"+t).on(r+".jcrop.jcrop-"+t,function(t,e,r){n.call(i,r)}),delete e[t])})},setupEvents:function(){var t=this,e=t.core;e.event.on("configupdate.jcrop-stage",function(n){t.shimLegacyHandlers(e.opt),t.tellConfigUpdate(e.opt),e.container.trigger("cropconfig",[e,e.opt])}),this.core.container.on("mousedown.jcrop.jcrop-stage",this.startDragHandler())}}),e.registerComponent("StageManager",C);var S=function(){};t.extend(S,{defaults:{selection:null,fading:!0,fadeDelay:1e3,fadeDuration:1e3,autoHide:!1,width:80,height:80,_hiding:null},prototype:{recopyCanvas:function(){var t=this.core.ui.stage,e=t.context;this.context.putImageData(e.getImageData(0,0,t.canvas.width,t.canvas.height),0,0)},init:function(e,n){var i=this;this.core=e,t.extend(this,S.defaults,n),i.initEvents(),i.refresh(),i.insertElements(),i.selection?(i.renderSelection(i.selection),i.selectionTarget=i.selection.element[0]):i.core.ui.selection&&i.renderSelection(i.core.ui.selection),i.core.ui.stage.canvas&&(i.context=i.preview[0].getContext("2d"),i.core.container.on("cropredraw",function(t){i.recopyCanvas(),i.refresh()}))},updateImage:function(e){return this.preview.remove(),this.preview=t(t.Jcrop.imageClone(e)),this.element.append(this.preview),this.refresh(),this},insertElements:function(){this.preview=t(t.Jcrop.imageClone(this.core.ui.stage.imgsrc)),this.element=t("<div />").addClass("jcrop-thumb").width(this.width).height(this.height).append(this.preview).appendTo(this.core.container)},resize:function(t,e){this.width=t,this.height=e,this.element.width(t).height(e),this.renderCoords(this.last)},refresh:function(){this.cw=this.core.opt.xscale*this.core.container.width(),this.ch=this.core.opt.yscale*this.core.container.height(),this.last&&this.renderCoords(this.last)},renderCoords:function(t){var e=this.width/t.w,n=this.height/t.h;return this.preview.css({width:Math.round(e*this.cw)+"px",height:Math.round(n*this.ch)+"px",marginLeft:"-"+Math.round(e*t.x)+"px",marginTop:"-"+Math.round(n*t.y)+"px"}),this.last=t,this},renderSelection:function(t){return this.renderCoords(t.core.unscale(t.get()))},selectionStart:function(t){this.renderSelection(t)},show:function(){this._hiding&&clearTimeout(this._hiding),this.fading?this.element.stop().animate({opacity:1},{duration:80,queue:!1}):this.element.stop().css({opacity:1})},hide:function(){var t=this;t.fading?t._hiding=setTimeout(function(){t._hiding=null,t.element.stop().animate({opacity:0},{duration:t.fadeDuration,queue:!1})},t.fadeDelay):t.element.hide()},initEvents:function(){var t=this;t.core.container.on("croprotstart croprotend cropimage cropstart cropmove cropend",function(e,n,i){if(t.selectionTarget&&t.selectionTarget!==e.target)return!1;switch(e.type){case"cropimage":t.updateImage(i);break;case"cropstart":t.selectionStart(n);case"croprotstart":t.show();break;case"cropend":t.renderCoords(i);case"croprotend":t.autoHide&&t.hide();break;case"cropmove":t.renderCoords(i)}})}}}),e.registerComponent("Thumbnailer",S);var D=function(){};D.prototype={init:function(e,n,i){n||(n=e.container),this.$btn=t(n),this.$targ=t(n),this.core=e,this.$btn.addClass("dialdrag").on("mousedown.dialdrag",this.mousedown()).data("dialdrag",this),t.isFunction(i)||(i=function(){}),this.callback=i,this.ondone=i},remove:function(){return this.$btn.removeClass("dialdrag").off(".dialdrag").data("dialdrag",null),this},setTarget:function(e){return this.$targ=t(e),this},getOffset:function(){var t=this.$targ,e=t.offset();return[e.left+t.width()/2,e.top+t.height()/2]},relMouse:function(t){var e=t.pageX-this.offset[0],n=t.pageY-this.offset[1],i=Math.atan2(n,e)*(180/Math.PI),r=Math.sqrt(Math.pow(e,2)+Math.pow(n,2));return[e,n,i,r]},mousedown:function(){function e(e){t(window).off(".dialdrag"),i.ondone.call(i,i.relMouse(e)),i.core.container.trigger("croprotend")}function n(t){i.callback.call(i,i.relMouse(t))}var i=this;return function(r){i.offset=i.getOffset();var o=i.relMouse(r);return i.angleOffset=-i.core.ui.stage.angle+o[2],i.distOffset=o[3],i.dragOffset=[o[0],o[1]],i.core.container.trigger("croprotstart"),t(window).on("mousemove.dialdrag",n).on("mouseup.dialdrag",e),i.callback.call(i,i.relMouse(r)),!1}}},e.registerComponent("DialDrag",D),e.defaults={edge:{n:0,s:0,e:0,w:0},setSelect:null,linked:!0,linkCurrent:!0,canDelete:!0,canSelect:!0,canDrag:!0,canResize:!0,eventManagerComponent:e.component.EventManager,keyboardComponent:e.component.Keyboard,dragstateComponent:e.component.DragState,stagemanagerComponent:e.component.StageManager,animatorComponent:e.component.Animator,selectionComponent:e.component.Selection,stageConstructor:e.stageConstructor,allowSelect:!0,multi:!1,multiMax:!1,multiCleanup:!0,animation:!0,animEasing:"swing",animDuration:400,fading:!0,fadeDuration:300,fadeEasing:"swing",bgColor:"black",bgOpacity:.5,applyFilters:["constrain","extent","backoff","ratio","shader","round"],borders:["e","w","s","n"],handles:["n","s","e","w","sw","ne","nw","se"],dragbars:["n","e","w","s"],dragEventTarget:window,xscale:1,yscale:1,boxWidth:null,boxHeight:null,css_nodrag:"jcrop-nodrag",css_drag:"jcrop-drag",css_container:"jcrop-active",css_shades:"jcrop-shades",css_selection:"jcrop-selection",css_borders:"jcrop-border",css_handles:"jcrop-handle jcrop-drag",css_button:"jcrop-box jcrop-drag",css_noresize:"jcrop-noresize",css_dragbars:"jcrop-dragbar jcrop-drag",legacyHandlers:{onChange:"cropmove",onSelect:"cropend"}},t.extend(e.prototype,{init:function(){this.event=new this.opt.eventManagerComponent(this),this.ui.keyboard=new this.opt.keyboardComponent(this),this.ui.manager=new this.opt.stagemanagerComponent(this),this.applyFilters(),t.Jcrop.supportsTouch&&new t.Jcrop.component.Touch(this),this.initEvents()},applySizeConstraints:function(){var n=this.opt,i=this.opt.imgsrc;if(i){var r=i.naturalWidth||i.width,o=i.naturalHeight||i.height,s=n.boxWidth||r,a=n.boxHeight||o;if(i&&(r>s||o>a)){var c=e.getLargestBox(r/o,s,a);t(i).width(c[0]).height(c[1]),this.resizeContainer(c[0],c[1]),this.opt.xscale=r/c[0],this.opt.yscale=o/c[1]}}if(this.opt.trueSize){var h=this.opt.trueSize[0],u=this.opt.trueSize[1],l=this.getContainerSize();this.opt.xscale=h/l[0],this.opt.yscale=u/l[1]}},initComponent:function(t){if(e.component[t]){var n=Array.prototype.slice.call(arguments),i=new e.component[t];return n.shift(),n.unshift(this),i.init.apply(i,n),i}},setOptions:function(e,n){return t.isPlainObject(e)||(e={}),t.extend(this.opt,e),this.opt.setSelect&&(this.ui.multi.length||this.newSelection(),this.setSelect(this.opt.setSelect),this.opt.setSelect=null),this.event.trigger("configupdate"),this},destroy:function(){this.opt.imgsrc?(this.container.before(this.opt.imgsrc),this.container.remove(),t(this.opt.imgsrc).removeData("Jcrop").show()):this.container.remove()},applyFilters:function(){for(var e,n=0,i=this.opt.applyFilters,r=i.length;r>n;n++)t.Jcrop.filter[i[n]]&&(e=new t.Jcrop.filter[i[n]]),e.core=this,e.init&&e.init(),this.filter[i[n]]=e},getDefaultFilters:function(){for(var t=[],e=0,n=this.opt.applyFilters,i=n.length;i>e;e++)this.filter.hasOwnProperty(n[e])&&t.push(this.filter[n[e]]);return t.sort(function(t,e){return t.priority-e.priority}),t},setSelection:function(t){for(var e=this.ui.multi,n=[],i=0;i<e.length;i++)e[i]!==t&&n.push(e[i]),e[i].toBack();return n.unshift(t),this.ui.multi=n,this.ui.selection=t,t.toFront(),t},getSelection:function(t){var e=this.ui.selection.get();return this.unscale(e)},newSelection:function(t){return t||(t=new this.opt.selectionComponent),t.init(this),this.setSelection(t),t},hasSelection:function(t){for(var e=0;e<this.ui.multi;e++)if(t===this.ui.multi[e])return!0},removeSelection:function(t){for(var e,n=[],i=this.ui.multi,e=0;e<i.length;e++)t!==i[e]?n.push(i[e]):i[e].remove();return this.ui.multi=n},addFilter:function(t){for(var e=0,n=this.ui.multi,i=n.length;i>e;e++)n[e].addFilter(t);return this},removeFilter:function(t){for(var e=0,n=this.ui.multi,i=n.length;i>e;e++)n[e].removeFilter(t);return this},blur:function(){return this.ui.selection.blur(),this},focus:function(){return this.ui.selection.focus(),this},initEvents:function(){var t=this;t.container.on("selectstart",function(t){return!1}).on("mousedown","."+t.opt.css_drag,t.startDrag())},maxSelect:function(){this.setSelect([0,0,this.elw,this.elh])},nudge:function(t,e){var n=this.ui.selection,i=n.get();i.x+=t,i.x2+=t,i.y+=e,i.y2+=e,i.x<0?(i.x2=i.w,i.x=0):i.x2>this.elw&&(i.x2=this.elw,i.x=i.x2-i.w),i.y<0?(i.y2=i.h,i.y=0):i.y2>this.elh&&(i.y2=this.elh,i.y=i.y2-i.h),n.element.trigger("cropstart",[n,this.unscale(i)]),n.updateRaw(i,"move"),n.element.trigger("cropend",[n,this.unscale(i)])},refresh:function(){for(var t=0,e=this.ui.multi,n=e.length;n>t;t++)e[t].refresh()},blurAll:function(){for(var t=this.ui.multi,e=0;e<t.length;e++)t[e]!==sel&&n.push(t[e]),t[e].toBack()},scale:function(t){var e=this.opt.xscale,n=this.opt.yscale;return{x:t.x/e,y:t.y/n,
x2:t.x2/e,y2:t.y2/n,w:t.w/e,h:t.h/n}},unscale:function(t){var e=this.opt.xscale,n=this.opt.yscale;return{x:t.x*e,y:t.y*n,x2:t.x2*e,y2:t.y2*n,w:t.w*e,h:t.h*n}},requestDelete:function(){return this.ui.multi.length>1&&this.ui.selection.canDelete?this.deleteSelection():void 0},deleteSelection:function(){this.ui.selection&&(this.removeSelection(this.ui.selection),this.ui.multi.length&&this.ui.multi[0].focus(),this.ui.selection.refresh())},animateTo:function(t){return this.ui.selection&&this.ui.selection.animateTo(t),this},setSelect:function(t){return this.ui.selection&&this.ui.selection.update(e.wrapFromXywh(t)),this},startDrag:function(){var e=this;return function(n){var i=t(n.target),r=i.closest("."+e.opt.css_selection).data("selection"),o=i.data("ord");return e.container.trigger("cropstart",[r,e.unscale(r.get())]),r.startDrag(n,o),!1}},getContainerSize:function(){return[this.container.width(),this.container.height()]},resizeContainer:function(t,e){this.container.width(t).height(e),this.refresh()},setImage:function(e,n){var i=this,r=i.opt.imgsrc;return r?void new t.Jcrop.component.ImageLoader(e,null,function(o,s){i.resizeContainer(o,s),r.src=e,t(r).width(o).height(s),i.applySizeConstraints(),i.refresh(),i.container.trigger("cropimage",[i,r]),"function"==typeof n&&n.call(i,o,s)}):!1},update:function(t){this.ui.selection&&this.ui.selection.update(t)}}),t.fn.Jcrop=function(e,n){e=e||{};var i=this.eq(0).data("Jcrop"),r=Array.prototype.slice.call(arguments);return"api"==e?i:i&&"string"==typeof e?i[e]?(r.shift(),i[e].apply(i,r),i):!1:void this.each(function(){var i=t(this),r=i.data("Jcrop");return r?r.setOptions(e):(e.stageConstructor||(e.stageConstructor=t.Jcrop.stageConstructor),e.stageConstructor(this,e,function(e,r){var o=r.setSelect;o&&delete r.setSelect;var s=t.Jcrop.attach(e.element,r);"function"==typeof e.attach&&e.attach(s),i.data("Jcrop",s),o&&(s.newSelection(),s.setSelect(o)),"function"==typeof n&&n.call(s)})),this})};var E=function(t,e,n){function i(t){v.cssText=t}function r(t,e){return typeof t===e}function o(t,e){return!!~(""+t).indexOf(e)}function s(t,e){for(var i in t){var r=t[i];if(!o(r,"-")&&v[r]!==n)return"pfx"==e?r:!0}return!1}function a(t,e,i){for(var o in t){var s=e[t[o]];if(s!==n)return i===!1?t[o]:r(s,"function")?s.bind(i||e):s}return!1}function c(t,e,n){var i=t.charAt(0).toUpperCase()+t.slice(1),o=(t+" "+b.join(i+" ")+i).split(" ");return r(e,"string")||r(e,"undefined")?s(o,e):(o=(t+" "+C.join(i+" ")+i).split(" "),a(o,e,n))}var h,u,l,p="2.7.1",f={},d=e.documentElement,g="modernizr",m=e.createElement(g),v=m.style,y={}.toString,x=" -webkit- -moz- -o- -ms- ".split(" "),w="Webkit Moz O ms",b=w.split(" "),C=w.toLowerCase().split(" "),S={svg:"http://www.w3.org/2000/svg"},D={},E=[],j=E.slice,M=function(t,n,i,r){var o,s,a,c,h=e.createElement("div"),u=e.body,l=u||e.createElement("body");if(parseInt(i,10))for(;i--;)a=e.createElement("div"),a.id=r?r[i]:g+(i+1),h.appendChild(a);return o=["&#173;",'<style id="s',g,'">',t,"</style>"].join(""),h.id=g,(u?h:l).innerHTML+=o,l.appendChild(h),u||(l.style.background="",l.style.overflow="hidden",c=d.style.overflow,d.style.overflow="hidden",d.appendChild(l)),s=n(h,t),u?h.parentNode.removeChild(h):(l.parentNode.removeChild(l),d.style.overflow=c),!!s},F=function(){function t(t,o){o=o||e.createElement(i[t]||"div"),t="on"+t;var s=t in o;return s||(o.setAttribute||(o=e.createElement("div")),o.setAttribute&&o.removeAttribute&&(o.setAttribute(t,""),s=r(o[t],"function"),r(o[t],"undefined")||(o[t]=n),o.removeAttribute(t))),o=null,s}var i={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return t}(),T={}.hasOwnProperty;l=r(T,"undefined")||r(T.call,"undefined")?function(t,e){return e in t&&r(t.constructor.prototype[e],"undefined")}:function(t,e){return T.call(t,e)},Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if("function"!=typeof e)throw new TypeError;var n=j.call(arguments,1),i=function(){if(this instanceof i){var r=function(){};r.prototype=e.prototype;var o=new r,s=e.apply(o,n.concat(j.call(arguments)));return Object(s)===s?s:o}return e.apply(t,n.concat(j.call(arguments)))};return i}),D.canvas=function(){var t=e.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},D.canvastext=function(){return!(!f.canvas||!r(e.createElement("canvas").getContext("2d").fillText,"function"))},D.touch=function(){var n;return"ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch?n=!0:M(["@media (",x.join("touch-enabled),("),g,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(t){n=9===t.offsetTop}),n},D.draganddrop=function(){var t=e.createElement("div");return"draggable"in t||"ondragstart"in t&&"ondrop"in t},D.csstransforms=function(){return!!c("transform")},D.svg=function(){return!!e.createElementNS&&!!e.createElementNS(S.svg,"svg").createSVGRect},D.inlinesvg=function(){var t=e.createElement("div");return t.innerHTML="<svg/>",(t.firstChild&&t.firstChild.namespaceURI)==S.svg},D.svgclippaths=function(){return!!e.createElementNS&&/SVGClipPath/.test(y.call(e.createElementNS(S.svg,"clipPath")))};for(var k in D)l(D,k)&&(u=k.toLowerCase(),f[u]=D[k](),E.push((f[u]?"":"no-")+u));return f.addTest=function(t,e){if("object"==typeof t)for(var i in t)l(t,i)&&f.addTest(i,t[i]);else{if(t=t.toLowerCase(),f[t]!==n)return f;e="function"==typeof e?e():e,"undefined"!=typeof enableClasses&&enableClasses&&(d.className+=" "+(e?"":"no-")+t),f[t]=e}return f},i(""),m=h=null,f._version=p,f._prefixes=x,f._domPrefixes=C,f._cssomPrefixes=b,f.hasEvent=F,f.testProp=function(t){return s([t])},f.testAllProps=c,f.testStyles=M,f}(window,window.document);!function(){var t=new Image;t.onerror=function(){E.addTest("datauri",function(){return!1})},t.onload=function(){E.addTest("datauri",function(){return 1==t.width&&1==t.height})},t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}(),t.Jcrop=e,t.Jcrop.supportsCanvas=E.canvas,t.Jcrop.supportsCanvasText=E.canvastext,t.Jcrop.supportsDragAndDrop=E.draganddrop,t.Jcrop.supportsDataURI=E.datauri,t.Jcrop.supportsSVG=E.svg,t.Jcrop.supportsInlineSVG=E.inlinesvg,t.Jcrop.supportsSVGClipPaths=E.svgclippaths,t.Jcrop.supportsCSSTransforms=E.csstransforms,t.Jcrop.supportsTouch=E.touch}(jQuery);